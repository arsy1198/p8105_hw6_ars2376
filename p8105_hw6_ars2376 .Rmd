---
title: "p8105_hw6_ars2376"
output: github_document
date: "2025-11-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(modelr)
library(broom)
library(purrr)
```

## Problem 1

Clean and filter homicide data

```{r, warning = FALSE}
homicides_df = read.csv("homicide-data.csv") |>
  mutate(city_state = paste(city, state, sep = ", "), 
         solved_homicide = if_else(disposition == "Closed by arrest", 1, 0)) |> 
  filter(
    !city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"
  )) |> 
  filter(
    victim_race %in% c("White", "Black")) |> 
  mutate(victim_age = as.numeric(victim_age))

```

Logistic regression for Baltimore, MD

```{r}
baltimore_df = homicides_df |> 
  filter(
    city_state == "Baltimore, MD")
  
baltimore_log = glm(solved_homicide ~ victim_age + victim_sex + victim_race, family = binomial, data = baltimore_df) |> broom::tidy(conf.int = TRUE, exponentiate = TRUE)

male_or = baltimore_log |> 
  filter(term == "victim_sexMale") |> 
  select(term, estimate, conf.low, conf.high)

print(male_or)

```

Adjusted OR and CI for each city

```{r, warning = FALSE}
allcities_log = homicides_df |> 
  group_by(city_state) |> 
  nest() |> 
  mutate(
    log_model = map(data, ~glm(
      solved_homicide ~ victim_age + victim_sex + victim_race, family = binomial, data = .x
    )),
  allcities_tidy = map(log_model, ~tidy(.x, conf.int = TRUE, exponentiate = TRUE))
  ) |> 
  unnest(allcities_tidy) |> 
  filter(term == "victim_sexMale") |> 
  select(city_state, estimate, conf.low, conf.high)
```

Plot of estimated ORs and CIs for each city

```{r}
allcities_log |> 
  ggplot(aes(reorder(city_state, estimate), estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin=conf.low, ymax = conf.high)) +
  coord_flip()+
  labs(
    title = "Adjusted Odds Ratio of Solved Homicides by City",
    x = "City, State",
    y = "OR, Male vs. Female "
  )
```

For most cities, the adjusted odds ratio is less than 1, which entails that homicides of male victims are less likely to be solved than those of female victims after adjusting for age and race. Additionally, Albuquerque, NM has the highest adjusted OR. This means that homicides of male victims had the highest likelihood of being solved than that of female victims of all 50 cities after adjusting for age and race.

## Problem 2

```{r}
library(p8105.datasets)
data("weather_df")

bootstrap = 
  tibble(iter = 1:5000) |> 
  mutate(
    bootstrap_sample = map(iter, ~weather_df |> slice_sample(prop = 1, replace = TRUE)),
    bootstrap_model = map(bootstrap_sample, ~lm(tmax ~ tmin + prcp, data = .x)),
    r2 = map_dbl(bootstrap_model, ~glance(.x)$r.squared),
    beta = map_dbl(bootstrap_model, ~{
      coefs = tidy(.x)
      b1 = coefs$estimate[coefs$term == "tmin"]
      b2 = coefs$estimate[coefs$term == "prcp"]
      b1/b2
    })
  )
```
Plot of r^2

```{r}
ggplot(bootstrap, aes(x = r2)) +
  geom_histogram(bins = 50) +
  labs(
    title = "Distribution of R^2",
    x = "R^2",
    y = "Count"
  )
```

The bootstrap distribution of R^2 is approximately normal, which suggests the model's explanatory power is relatively stable across samples.

Plot of B1/B2

```{r}
ggplot(bootstrap, aes(x = beta)) +
  geom_histogram(bins = 50) +
  labs(
    title = "Bootstrap Distribution of β1/β2",
    x = "β1/β2")
```

The bootstrap distribution of β1/β2 is skewed to the left. This is common in ratios of random variables.

CIs for R^2 and β1/β2

```{r}
ci_r2 = quantile(bootstrap$r2, c(.025, .975))
ci_beta = quantile(bootstrap$beta, c(.025, .975))

print(ci_r2)
print(ci_beta)
```
